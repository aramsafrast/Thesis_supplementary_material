# load librarues
library(SingleR)
library(Seurat)
library(liana)
library(tidyverse)
library(data.table)
library(scran)
library(BulkSignalR)
library(tidyverse)
library(pheatmap)
library(UpSetR)
library(ggvenn)
library(scales)
library(circlize)
library(openxlsx)
library(cowplot)
library(viridis)
library(ggpubr)
load("/home/bioinf/R_main/cellcell/sc/hbv/hcc_hbv_sc.RData")
gc()
ref_countm <- read.csv("/home/bioinf/Downloads/scrna_countm.csv")
ref_annot <- read.delim("/home/bioinf/Desktop/wgcna_manuscript/cfwgcna_hcc/scrna/data/raw/scrna_metadata_init.txt")
ref_annot$CellType <- ifelse(grepl("Hepatocyte", ref_annot$CellType), "Hepatocyte", ref_annot$CellType)
ref_annot$CellType <- ifelse(grepl("T_Cells", ref_annot$CellType), "T_Cells", ref_annot$CellType)
ref_annot$CellType <- ifelse(grepl("LSECs", ref_annot$CellType), "LSECs", ref_annot$CellType)
ref_annot$CellType <- ifelse(grepl("Macrophage", ref_annot$CellType), "Macrophage", ref_annot$CellType)
ref_countm <- ref_countm %>%
column_to_rownames(., var = "X") %>%
as.matrix()
hcc_sc_hbv <- hcc_sc_hbv %>% column_to_rownames(var = "V1")
hcc_sc_hbv <- as.matrix(hcc_sc_hbv)
gc()
# annotation
hcc_hbv_annot <- SingleR(test = hcc_sc_hbv, ref = ref_countm, labels = ref_annot$CellType, de.method = "wilcox")
gc()
# LRI detection
seurat_object <- CreateSeuratObject(counts = hcc_sc_hbv)
gc()
seurat_object <- AddMetaData(seurat_object, hcc_hbv$sample, col.name = "sample")
seurat_object <- AddMetaData(seurat_object, hcc_hbv$stage, col.name = "stage")
seurat_object <- AddMetaData(seurat_object, hcc_hbv_annot$labels, col.name = "celltype")
seurat_object <- SetIdent(seurat_object, value = "celltype")
seurat_object <- NormalizeData(seurat_object)
gc()
save(seurat_object, file="/home/bioinf/Desktop/seurat_object.RData")
